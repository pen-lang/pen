import Test'Assert

import 'Parse { Parse }
import 'Value { Value }

ParseNull = \() none | error {
  Assert'True(Parse("null")? == Value'New(none))
}

ParseTrue = \() none | error {
  Assert'True(Parse("true")? == Value'New(true))
}

ParseFalse = \() none | error {
  Assert'True(Parse("false")? == Value'New(false))
}

ParseInteger = \() none | error {
  Assert'True(Parse("0")? == Value'New(0))?
  Assert'True(Parse("1")? == Value'New(1))?
  Assert'True(Parse("9")? == Value'New(9))?
  Assert'True(Parse("42")? == Value'New(42))
}

ParseNegativeInteger = \() none | error {
  Assert'True(Parse("-0")? == Value'New(-0))?
  Assert'True(Parse("-1")? == Value'New(-1))?
  Assert'True(Parse("-42")? == Value'New(-42))
}

ParseDecimal = \() none | error {
  Assert'True(Parse("0.05")? == Value'New(0.05))?
  Assert'True(Parse("1.05")? == Value'New(1.05))?
  Assert'True(Parse("42.05")? == Value'New(42.05))
}

ParseEmptyString = \() none | error {
  Assert'True(Parse("\"\"")? == Value'New(""))
}

ParseString = \() none | error {
  Assert'True(Parse("\"foo\"")? == Value'New("foo"))
}

FailToParseStringWithUnexpectedEnd = \() none | error {
  Assert'True(
    if r = Parse("\"") as error {
      if s = source(r) as string {
        s == "unexpected end of string"
      } else {
        false
      }
    } else {
      false
    },
  )
}

ParseStringWithDoubleQuote = \() none | error {
  Assert'True(Parse("\"\\\"\"")? == Value'New("\""))
}

ParseArray = \() none | error {
  Assert'True(Parse("[]")? == Value'New([Value]))?
  Assert'True(Parse("[42]")? == Value'New([Value Value'New(42)]))?
  Assert'True(Parse("[ 42 ]")? == Value'New([Value Value'New(42)]))?
  Assert'True(Parse("[0,1]")? == Value'New([Value Value'New(0), Value'New(1)]))?
  Assert'True(Parse("[0 , 1]")? == Value'New([Value Value'New(0), Value'New(1)]))?
  Assert'True(Parse("[0, 1, 2]")? == Value'New([Value Value'New(0), Value'New(1), Value'New(2)]))
}

ParseNestedArray = \() none | error {
  Assert'True(Parse("[[]]")? == Value'New([Value Value'New([Value])]))
}

FailToParseTrailingCommaInArray = \() none | error {
  Assert'Error(Parse("[0,]"))
}

ParseEmptyObject = \() none | error {
  Assert'True(Parse("{}")? == Value'New({string: Value}))
}

ParseObject = \() none | error {
  Assert'True(Parse("{\"\": null}")? == Value'New({string: Value "": Value'New(none)}))?

  Assert'True(
    Parse("{\"foo\": null, \"bar\": null}")?
      == Value'New({string: Value "foo": Value'New(none), "bar": Value'New(none)}),
  )?
}

SkipSpace = \() none | error {
  Assert'True(Parse(" null")? == Value'New(none))
}

SkipTab = \() none | error {
  Assert'True(Parse("\tnull")? == Value'New(none))
}

SkipNewline = \() none | error {
  Assert'True(Parse("\nnull")? == Value'New(none))
}

SkipSpaces = \() none | error {
  Assert'True(Parse("  null")? == Value'New(none))
}

SkipTrailingSpaces = \() none | error {
  Assert'True(Parse("null  ")? == Value'New(none))
}

FailUnexpectedCharacter = \() none | error {
  Assert'True(if r = Parse("null a") as error { true } else { false })
}
